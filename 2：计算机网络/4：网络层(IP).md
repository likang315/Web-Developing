### 网络层：IP

------

在网络中找到另一台计算机在哪里，是否属于同一个子网，选路和转发

##### 1：互联网的定义：

​	采用分组交换技术，使用TCP/IP协议，将不同的类型的网络互联在一起而形成覆盖全球的技术设施

- 组成互联网的基础单元：
  1. 终端
  2. 链路
  3. 路由器
  4. 交换机

##### 2：TCP/IP协议的特点

1. 漏斗模型
2. 无状态结构
3. 接口开放

##### 3：网络层

- ###### 选路

  - 路由器之间通过路由信息的交换和路由算法的执行，创建路由表，决定端到端的转发的路径过程

- ###### 转发

  - 指路由器从输入接口输入一个分组后，根据分组的目的地址查询路由表（ARP表），将分组转发到指定的输出端口的过程。此过程可能产生ICMP信息

##### 4：IP报文格式

![IP报文格式,Ip](/Users/likang/Code/Git/Web-Developing/2：计算机网络/网络层/IP报文格式,Ip.png)

- 标示符：一个分组在传输过程中可能被分片，该字段用于标示那些分片属于同一个分组中
- 分片标志：标示该分组是否被分片传输
- 分片偏移量：重新组装一个分组时，指示分片在原组中的位置
- 协议：指明IP分组净负荷来自上层的那个协议

##### 5：IP地址

- IPv4：使用4个字节（ 32 个比特）来表示，中间用 "." 分隔

  - 构成：网络ID + 主机ID 

  - 网络ID为网段（子网），可以用子网掩码进行与运算来确定

  - 子网掩码：一个特殊的IP，网络ID全为1，主机ID全为0

  - ###### 特殊IP

    - | <net> | <host> | 意义     |              |
      | ----- | ------ | -------- | ------------ |
      | 全 0  | 全 0   | 本级IP   |              |
      | 任意  | 全 0   | 网络地址 | 标示一个网络 |
      | 任意  | 全 1   | 定向广播 | 指向网络上   |
      | 全 1  | 全 1   | 有限广播 | 在本地网中   |
      | 127.X | X.X    | 测试     | 环回IP       |

  - 内网多个主机可共用一个公网IP地址连接Internet，使用网络地址（NAT转换）

- IPv6：使用16 个字节（ 128个比特），写成8个16比特的无符号整数，每个整数用4个十六进制位表示，这些数之间用冒号 ":" 分开

  - 三种表示：
    1. 冒分十六进制表示法：ABCD:EF01:2345:6789:ABCD:EF01:2345:6789
       - 冒号十六进制记法允许零压缩，即一串连续的0可以用一对冒号取代 "：："
    2. 0位压缩表示法：0:0:0:0:0:0:0:1 → ::1
    3. 内嵌 IPv4 地址 示法：X:X:X:X:X:X:d.d.d.d，前96 bit采用冒分十六进制表示，而最后 32bit 地址则使用IPv4的点分十进制表示

##### 6：子网划分，ARP，无分类域间路由

- 地址分配规则：
  - 每个路由器的接口连接一个IP子网，每个IP子网的对应一个网络ID，一个IP子网的接口的网络ID相同，主机ID不同，IP子网，又称**网段**

##### 子网划分

1. 定长子网划分：将分类地址中的主机ID进一步分成网络ID和主机ID
   - IP：网络ID—子网ID—主机ID
   - 子网的内部路由器使用前缀确定子网：网路ID—子网ID
   - IP地址：xxx.xxx.xxx.xxx/24，子网掩码位数占24bit
2. 可变长子网掩码（VLSM）：
   - 为不同的子网使用不同的掩码

##### 7：ARP协议（Address Resolution Protocol）-RARP

- 地址解析协议，是根据IP地址获取MAC地址的一个TCP/IP协议
- 流程
  - 本地主机将包含目标IP地址的请求消息广播到局域网络上的所有主机，目的主机看到是自己的IP时，会单播一条响应消息，包含自己的MAC地址，本地接收响应消息，以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源
  - 若**不处于同一个子网下，就发送给网关**，让网关（路由器）转发放到目标子网中

##### 8：无分类域间路由选择

- CIDR：不再以分类地址为单位进行分配，而是根据网络的实际规模将任意连续的地址块分给一个机构，拥有着再进一步对子网划分
- 表示：前缀/长度；描述一个网络时，域间选路时仅提供IP网络前缀部分用于选路
- 路由聚合：CIDR将若干个连续的，相同的前缀取出构成一个更大的前缀，构成超网（superNet）
- 最长前缀匹配原则：选择路由时，最长的网络前缀匹配

##### 9：ICMP：互联网控制消息协议

- 通过在网络中产生错误和通知消息以增强互联网的可管理性，通过IP包承载

##### 10：路由器

在网络中转发和分组的设备，第三层设备

- 路由选择：执行路由协议，创建、维护路由表，生成转发表
  - 当一个IP数据包从一台计算机被发送，它会到达一个IP路由器，路由器负责将这个包路由至它的目的地，或者间接地通过其他的路由器，在一个相同的通信中，一个包所经由的路径可能会和其他的包不同。而路由器负责根据通信量、网络中的错误或者其他参数来进行正确地寻址
- 转发：根据IP地址查找转发表，转发到指定端口

##### 11：路由表，路由协议

![](/Users/likang/Code/Git/Web-Developing/2：计算机网络/网络层/路由表，路由协议.png)

##### 12：Dikastra 算法



