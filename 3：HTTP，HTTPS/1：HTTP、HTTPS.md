### HTTP 协议

------

​	HyperText Transfer Protocol(超文本传输协议)：从万维网服务器传输超文本到本地浏览器的传送协议

##### 1：HTTP 通信过程

- HTTP协议工作于客户端-服务端（C/S）架构上
- 浏览器作为 HTTP 客户端通过 URL向HTTP服务端即（WEB服务器）发送所有请求，Web服务器根据接收到的请求后，向客户端发送响应信息
- HTTP **默认端口号：80**

###### 特点：

- HTTP是**无连接的**，即每次只处理一个请求，服务器处理完请求即断开连接
- HTTP是**媒体独立的**，即任何类型文件都可以用HTTP传输
- HTTP是**无状态的**，即不具备保存之前发送过的请求或响应的功能，可以通过 Cookie 和 Session 或者重写URl保存

##### 2：HTTP 报文格式

![](https://github.com/likang315/Web-Developing/blob/master/3%EF%BC%9AHTTP%EF%BC%8CHTTPS/HTTP%E3%80%81HTTPS/%E8%AF%B7%E6%B1%82%E6%8A%A5%E5%A4%B4.png?raw=true)

###### 请求报文格式：

- 请求行 
- 请求首部字段 
- 通用首部字段 
- 实体首部字段 
- 空行（CR+LF） 
- 报文主体

1. 请求报头：
   - 请求方法 请求URL HTTP协议版本
   - 请求的首部字段
2. 请求报体
   - 可选的内容实体

###### 响应报文格式：

- 状态行
- 响应首部字段
- 通用首部字段
- 实体首部字段
- 空行（CR+LF）
- 报文主体

1. 响应报头
   - HTTP协议版本 状态码 用以解释状态码的短语 响应首部字段
2. 响应主体：
   - 响应报体

```html
HTTP/1.1 200 OK
Server:Apache Tomcat/5.0.12
Date:Mon,6Oct2003 13:23:42 GMT
Content-Length:112

<html>
  <head>
    <title>HTTP响应示例<title>
  </head>
  <body>
        Hello HTTP!
  </body>
</html>
```

##### 3：HTTP支持的方法（8个）

1. GET：获取资源，请求访问指定的页面信息，并返回响应内容
2. POST：提交表单，向指定资源提交数据进行处理请求
3. PUT：修改数据，从客户端向服务器传送的文档数据保存
4. HEAD：获取报头，返回报头
5. DELETE ：删除文件，请求服务器删除指定的页面
6. OPTIONS：查询支持的方法，查询针对请求指定的资源支持方法
7. TRACE：追踪路经，让Web服务器端将之前的请求通信，环回给客户端，经过代理服务器，值-1
8. CONNECT：使用隧道协议通信，将连接改为网络隧道传输

###### post 和 put 的区别：

- PUT请求：PUT用于修改资源
- POST请求：POST用于获取资源

##### 4：HTTP 状态码：

​	由三个十进制数字组成，第一个十进制数字定义了状态码的类型，后两个数字没有分类的作用

- 1** ：信息，服务器收到请求，需要请求者继续执行操作
- 2** ：成功，操作被成功接收并处理
- 3** ：重定向，需要进一步的操作以完成请求
- 4** ：客户端错误，服务器无法处理请求
- 5** ：服务器错误，服务器在处理请求错误

###### 301：永久重定向

​	被请求的资源已永久移动到新位置，并且将来任何对此资源的引用都应该使用本响应返回的若干个URI之一，如果可能，拥有**链接编辑功能的客户端**应当自动把请求的地址修改为从服务器反馈回来的地址，而且这个响应也是可以缓存的

###### 302：临时重定向

​	请求的资源现在临时从不同的URI响应请求，由于这样的重定向是临时的，客户端应当继续向原有地址发送以后的请求，只有在Cache-Control或Expires中进行了指定的情况下，这个响应才是可缓存的

浏览器对302状态码的处理：POST重定向为GET

###### HTTP1.1新加入`303`和`307`状态码，把`302` 细分为：

- 303：对于POST请求，它表示**请求已经被处理**，客户端可以接着使用**GET方法去请求Location里的URI**
- 307：对于POST请求，表示**请求还没有被处理**，客户端应该**向Location里的URI重新发起POST请求**

###### 400：请求无效

###### 403：禁止访问

​	服务端接收用户请求，但是拒绝响应。服务器可以返回拒绝响应的原因，如果不希望返回客户端具体原因，可以使用404（Not Found）来代替

- 403.1 - Execute access forbidden
  - 服务器禁止执行
- 403.2 - Read access forbidden
  - 服务器禁止读
- 403.3 - Write access forbidden
  - 服务器禁止写

###### 404：请求的资源不存在

###### 500 ：内部服务器错误

###### 502：网关错误

​	作为网关或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效的响应

###### 504：Nginx 错误

​	一般是Nginx做为反向代理服务器的时候，所连接的应用服务器譬如Tomcat无响应导致的

##### 5：报文首部字段：由首部字段名和字段值构成，中间用 '：'分隔

1. 通用首部字段
2. 请求首部字段
3. 响应首部字段
4. 实体首部字段

###### 通用首部字段

- Cache-Control：操作缓存
  1. public：表明其他用户也可以利用缓存
  2. private：响应以特定的用户作为对象
  3. no-cache：防止从缓存中返回过期的资源，或者不缓存过期的资源
  4. no-store：不缓存在本地机器
- Connection：控制不再转发首部字段，管理持久连接
  1. 直接跟首部字段名，不在转发给代理的首部字段
  2. HTTP/1.1版本默认的连接时持久连接，之前的版本是非持久连接，Close,Keep-Alive
  3. Date：表明创建HTTP报文的日期和时间
  4. Upgrade：用于检测HTTP协议是够可以使用更高的协议，参数值为新的协议
  5. Via：为了追踪报文的转发，以及避免请求回环的发生
  6. Warning：[警告码] [警告的主机:端口号] "[警告码]" （[日期时间]）

###### 请求首部字段

- Accept：通知服务器，用户可以处理的媒体类型，以及媒体类型的优先级，q=来表示权重值（0-1）

- Accept-Charset：通知服务器支持的字符集及字符集的相对优先级顺序

- Accept-Encoding：通知服务器用户支持的内容的编码及内容编码的优先级顺序

- Accept-Lanuage：通知服务器用户能够处理的语言集

- From：告知服务器用户代理的电子邮件地址

- ###### Host：告知服务器，请求的资源所处的互联网主机名和端口号

- If-Match：这种结构的请求首部字段，称为条件请求，只有条件判定为真时，执行

- Max-Forwards：表示可经过服务器的最大数目，每经过服务器的值-1，为0时，直接返回响应

- ###### Referer ：告知服务器请求的原始资源的URL

- User-Agent：会告知网站服务器，访问者是通过什么工具来请求的

###### 响应首部字段

- Accept-Ranges：告知客户端，服务器可以处理范围请求，以指定获取服务器端某个部分的资源

- Age：告知客户端，原服务器在多久之前创建了响应

- ETag：告知客户端实体标识，一种将资源以字符串形式做唯一性标识的方式

- ###### Location：将响应接受方引导至某个与请求URL位置不同的资源

###### 实体首部字段

- Allow：通知客户端支持的HTTP方法
- Content-Encoding
- Content-Language
- Content-Length：实体主体部分的大小
- Content-location：表示报文主体返回资源对应的URL
- Content-Type：实体主体的媒体类型
- Expires：缓存资源的有效日期

##### 6：Cookie、Session

- Cookie：带有用户状态信息的字段，sessionId
- Set-Cookie：当服务器准备开始管理客户端的状态时，会事先告知各种信息

##### 7：HTTP 特性

​	只要一端没有明确的提出断开连接，则保持TCP连接，**HTTP/1.1所有连接默认都是持久连接**

- 管线化：可以同时发送多个请求，解决了发送请求后需要等待并收到响应，才可以发送下一个请求问
- Cookie技术：通过在请求和响应中写入Cookie信息来得到之前的状态信息
  - Cookie 会根据从服务器端发送的响应报文内一个Set-Cookie的首部字段信息通知客户端保存Cookie，当下次客户端再往该服务器发送请求时客户端会自动在请求报文中加入Cookie值后发送出去，服务器会检查是哪一个客户端发送的请求，然后对比服务器上的记录，得到状态信息
- 分块传输编码：在传输大容量数据时，通过把数据分割为多块，能够让浏览器逐步显示页面
- 恢复：指能从之前下载中断处恢复下载，需指定范围请求
- 内容协商机制：客户端和服务器就响应的资源内容进行交涉，然后提供给客户端最为合适的资源

##### 8：Web 服务器

​	一个服务器可搭建多个独立域名的Web网站，利用虚拟主机（虚拟服务器）的功能，在相同IP下，由于虚拟主机可以寄存多个不同的主机名和域名的Web网站，所以发送请求时，必须在Host内完整制定域名的URL

- 代理：中间人的角色，把客户端发送的数据请求转发给服务器，同时也接受服务器的响应转发给客户端，使用代理服务器，利用缓存技术减少网络带宽流量，组织内部针对网站的访问控制
  1. 缓存代理：将资源的副本保存到代理服务器上
  2. 透明代理：不对报文做任何加工
- 网关：转发其他服务器通信数据的服务器，接受从客户端发送来的请求时，他就像拥有自己的资源一样对请求处理，利用网关可以提高通信的安全性，通过线路加密
- 隧道：在相隔甚远的客户端和服务器之间进行中转，并保持双方通信连接

##### 9：HTTP 轮询机制

###### HTTP 长轮询：

​	HTTP 长轮询是服务器收到请求后如果有数据, 立刻响应请求; 如果没有数据就会**等待一段时间**, 这段时间内如果有数据立刻响应请求，如果时间到了还没有数据, 则响应 HTTP 请求，浏览器受到 HTTP 响应后，**立即发送一个同样 HTTP 请求**查询是否有数据

- HTTP 长轮询的局限
  1. 浏览器端对服务器**同时 HTTP 连接数有最大限制, 最好同一用户只存在一个长轮询**
  2. 服务器端**没有数据等待连接时会造成浪费,** 容易产生服务器瓶颈

###### HTTP 短轮询：

​	HTTP 短轮询是服务器收到请求**不管是否有数据都直接响应 HTTP 请求**;，浏览器搜到 HTTP 响应**隔一段时间**再发送同样的 HTTP，请求查询是否有数据

- HTTP 短轮询的局限：实时性低

##### 10：HTTP 的不足

1. 通信使用**明文**，不加密，内容可能会被窃听
2. 不**验证双方的身份**，可能遭遇伪装
3. 无法**验证报文的完整性**，可能被篡改